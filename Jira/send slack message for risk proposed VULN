import groovy.json.JsonBuilder

def webhookUrl = 'https://hooks.slack.com/services/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'

def msg = [
    text: "The current sprint has now ended"
]

def postBody = new JsonBuilder(msg).toString()

def issueKey = issue.key
def status = issue.fields.status.name
logger.info(status)
def toStatusArray = ["Done"]

for (item in changelog.items) {
    logger.info(item.field)
    if (item.field == "status") {
        if (toStatusArray.contains(item.toString) && status == "Done") {
            def response = post(webhookUrl)
                .header('Content-Type', 'application/json')
                .body(postBody)
                .asString()

            if (response.status != 200) {
                println("Failed to send Slack notification: ${response.status} - ${response.body}")
            }
        }
    }
}
